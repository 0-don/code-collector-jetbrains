<idea-plugin>
    <id>don.codecollector</id>
    <name>Code Collector</name>
    <vendor email="don.cryptus@gmail.com" url="https://github.com/0-don">0-don</vendor>

    <description>
        <![CDATA[
            <p><strong>Efficiently collect code context for AI assistants by analyzing project dependencies.</strong></p>

            <h3>Features</h3>
            <ul>
              <li><strong>Smart Collection</strong>: Follows imports to gather related files automatically</li>
              <li><strong>Direct Collection</strong>: Copy selected files without dependency analysis</li>
              <li><strong>Full Project</strong>: Collect entire codebase with intelligent filtering</li>
              <li><strong>AI-Optimized</strong>: Formats output with file paths and line numbers</li>
            </ul>

            <h3>Output Format</h3>
            <pre>// src/main/kotlin/Service.kt (L1-L45)
            class UserService {
                // your code here
            }

            // src/main/kotlin/Model.kt (L46-L78)
            data class User(val id: Long)</pre>

            <h3>Usage</h3>
            <ul>
              <li>Right-click files/folders → "Code Collect (Smart)" - follows imports</li>
              <li>Right-click files/folders → "Code Collect (Direct)" - selected files only</li>
              <li>Right-click project → "Code Collect (All)" - entire codebase</li>
              <li>Keyboard shortcut: Ctrl+Shift+G</li>
            </ul>

            <p>Supports Java and Kotlin with configurable ignore patterns for build directories and generated files.</p>
        ]]>
    </description>

    <change-notes><![CDATA[
        <ul>
            <li>Initial release</li>
            <li>Smart import analysis for Java/Kotlin</li>
            <li>AI-optimized code context collection</li>
            <li>Configurable ignore patterns</li>
        </ul>
    ]]></change-notes>

    <!-- Core dependencies -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>
    <depends>org.jetbrains.kotlin</depends>

    <!-- K2 compatibility declaration -->
    <extensions defaultExtensionNs="org.jetbrains.kotlin">
        <supportsKotlinPluginMode supportsK2="true"/>
    </extensions>

    <extensions defaultExtensionNs="com.intellij">
        <notificationGroup id="Code Collector" displayType="BALLOON"/>
        <projectConfigurable
                parentId="tools"
                instance="don.codecollector.settings.CodeCollectorConfigurable"
                id="don.codecollector.settings"
                displayName="Code Collector"/>
    </extensions>

    <actions>
        <action id="don.codecollector.gatherImports"
                class="don.codecollector.actions.CodeCollectSmartAction"
                text="Code Collect (Smart)"
                description="Collect code context based on imports">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="before"
                          relative-to-action="CutCopyPasteGroup"/>
            <add-to-group group-id="EditorPopupMenu" anchor="after" relative-to-action="$Copy"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift G"/>
        </action>

        <action id="don.codecollector.collectSimple"
                class="don.codecollector.actions.CodeCollectDirectAction"
                text="Code Collect (Direct)"
                description="Collect only selected files without following imports">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after"
                          relative-to-action="don.codecollector.gatherImports"/>
        </action>

        <action id="don.codecollector.collectAll"
                class="don.codecollector.actions.CodeCollectAllAction"
                text="Code Collect (All)"
                description="Collect all project code">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after"
                          relative-to-action="don.codecollector.collectSimple"/>
        </action>
    </actions>
</idea-plugin>