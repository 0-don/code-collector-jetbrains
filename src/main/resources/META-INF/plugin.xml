<idea-plugin>
    <id>don.codecollector</id>
    <name>Code Collector</name>
    <vendor>0-don</vendor>

    <description><![CDATA[
    Gather code context for AI assistance by analyzing imports and collecting related Java/Kotlin files.
    Features:
    - Smart Import Analysis: Follows import chains to collect all related local files
    - Java & Kotlin Support: Handles both languages seamlessly
    - AI-Optimized Output: Line numbers and file headers for easy AI consumption
    - K2 Mode Compatible: Works with both K1 and K2 Kotlin compiler modes
    ]]></description>

    <!-- K2 compatibility -->
    <depends optional="true" config-file="kotlin-k2.xml">org.jetbrains.kotlin</depends>

    <!-- Core dependencies -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>
    <depends>org.jetbrains.kotlin</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Explicit K2 support declaration -->
        <registryKey
                key="kotlin.k2.only.bundled.compiler.plugins.enabled"
                defaultValue="true"
                description="Enable K2 support for Code Collector plugin"/>
    </extensions>

    <actions>
        <action id="don.codecollector.gatherImports"
                class="don.codecollector.actions.CodeCollectAction"
                text="Code Collect"
                description="Collect code context based on imports">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="first"/>
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift G"/>
        </action>

        <action id="don.codecollector.collectAll"
                class="don.codecollector.actions.CodeCollectAllAction"
                text="Code Collect All"
                description="Collect all project code">
            <add-to-group group-id="ProjectViewPopupMenu" anchor="after"
                          relative-to-action="don.codecollector.gatherImports"/>
        </action>
    </actions>
</idea-plugin>